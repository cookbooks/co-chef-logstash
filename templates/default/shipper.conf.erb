# Shipper Agent. 
#
# Reads logs from input  and ships them to AMQP.
# java -jar logstash-1.1.0-monolithic.jar agent -f shipper.conf


# TODO: specify vhost: http://logstash.net/docs/1.0.17/inputs/amqp
#
input {
<% @inputs.each do |section_data| %>
    <% section_data.each do |section, config| %>
    <%= section %> {
    <% if config %>
    <% config.each do |k, v| %>
        <%= k %> => <%= v.inspect %>
    <% end %>
    <% end %>
    }
    <% end %>
<% end %>
}

output {
  # Ship events to the amqp exchange
  # http://logstash.net/docs/1.1.0/outputs/amqp
  amqp {
    host => "<%= node['logstash']['amqp']['host'] %>"
    exchange_type => "<%= node['logstash']['amqp']['exchange_type'] %>"
    name => "<%= node['logstash']['amqp']['exchange'] %>"
    user => "<%= node['logstash']['amqp']['user'] %>"
    password => "<%= node['logstash']['amqp']['password'] %>"
    vhost => "<%= node['logstash']['amqp']['vhost'] %>"
    port => "<%= node['logstash']['amqp']['post'] %>"
    durable => "<%= node['logstash']['amqp']['durable'] %>"
    persistent => "<%= node['logstash']['amqp']['persistent'] %>"
    <% if node['logstash']['amqp']['debug'] %>debug => "true"<% end %>
  }
}
